---
import Layout from '@/layouts/Layout.astro'
import { getCollection } from 'astro:content'

import HeroSection from '@/components/blocks/hero-section/hero-section'
import Blog from '@/components/blocks/blog-component/blog-component'
import CTA from '@/components/blocks/cta-section/cta-section'

// Get all blog posts and convert to the format expected by components
const allPosts = await getCollection('blog')
const publishedPosts = allPosts

// Convert to the format expected by the React components
const allBlogPosts = publishedPosts
  .map((post, index) => ({
    id: post.data.id || index + 1,
    slug: post.data.slug || post.id,
    title: post.data.title,
    description: post.data.description,
    imageUrl: post.data.imageUrl || '/images/blog-post/post-1.webp',
    imageAlt: post.data.imageAlt || post.data.title,
    pubDate: post.data.pubDate,
    category: post.data.category,
    author: post.data.author,
    avatarUrl: post.data.avatarUrl || '/images/avatars/post-1.webp',
    readTime: post.data.readTime || 5,
    featured: post.data.featured || false
  }))
  .sort((a, b) => b.pubDate.getTime() - a.pubDate.getTime())

// Page-specific SEO configuration
const pageTitle = ''
const pageDescription =
  'Discover insightful articles and tutorials about modern web development, Astro, and building fast, scalable websites with cutting-edge tools.'
const pageKeywords =
  'web development, Astro tutorials, scalable websites, modern web technologies, SEO optimization, Tailwind CSS, shadcn UI'

// Structured data for better SEO
const schema = {
  '@context': 'https://schema.org',
  '@type': 'WebApplication',
  name: 'Ink',
  description: pageDescription,
  applicationCategory: 'DeveloperApplication',
  operatingSystem: 'Any',
  offers: {
    '@type': 'Offer',
    price: '0',
    priceCurrency: 'USD'
  },
  author: {
    '@type': 'Organization',
    name: 'Your Company Name'
  }
}
---

<Layout title={pageTitle} description={pageDescription} keywords={pageKeywords} schema={schema}>
  <!--  All Sections -->
  <HeroSection blogData={allBlogPosts} client:load />
  <Blog blogData={allBlogPosts} client:load />
  <CTA />
</Layout>
