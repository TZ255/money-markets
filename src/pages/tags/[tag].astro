---
import Layout from '@/layouts/Layout.astro'
import { getCollection } from 'astro:content'
import BlogList from '@/components/blog/BlogList.astro'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  const tags = new Set<string>()
  posts.forEach(post => post.data.tags?.forEach(tag => tags.add(tag)))

  return Array.from(tags).map(tag => ({ params: { tag } }))
}

const { tag } = Astro.params
const pageSize = 12
const allPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft && post.data.tags?.includes(tag))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())

const totalPages = Math.max(1, Math.ceil(allPosts.length / pageSize))
const pagePosts = allPosts.slice(0, pageSize)
---

<Layout
  title={`Tag: ${tag}`}
  description={`Makala zilizo na tag ${tag}`}
  type='website'
>
  <section class='py-12 sm:py-16'>
    <div class='mx-auto max-w-6xl px-4 sm:px-6 lg:px-8'>
      <BlogList posts={pagePosts} page={1} totalPages={totalPages} tag={tag} />
    </div>
  </section>
</Layout>
